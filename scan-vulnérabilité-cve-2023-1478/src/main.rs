use clap::Parser;
use reqwest::blocking::get;
use std::error::Error;

/// Activation des arguments 
#[derive(Parser)]
struct Args {
    /// Argument pour prendre l'ip 
    ip: String,
}

fn check(ip: &str) -> Result<bool, Box<dyn Error>> {
    let url = format!("http://{}/wordpress/wp-content/plugins/wp-hummingbird/changelog.txt", ip);
    let response = get(&url)?.text()?;

    Ok(!response.contains("3.4.2"))
}

fn main() {
    let args = Args::parse();

    match check(&args.ip) {
        Ok(is_vulnerable) => {
            if is_vulnerable {
                println!("Le serveur est vulnérable à CVE-2023-1478.");
            } else {
                println!("Le serveur n'est pas vulnérable à CVE-2023-1478.");
            }
        }
        Err(e) => {
            eprintln!("Erreur lors de la vérification du serveur : {}", e);
        }
    }
}
